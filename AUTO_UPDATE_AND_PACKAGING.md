# Atlas: Auto-update + Packaging (Tauri v2)

This project is a Tauri v2 desktop app (Rust) with a SvelteKit frontend.

## Goals

- Build installable packages:
  - macOS: `.dmg` / `.app`
  - Windows: `.msi` / installer (depending on your bundle settings)
- Publish releases on GitHub
- Enable auto-update using **GitHub Releases only**

> Note: You said you do **not** plan to code-sign. That’s fine for development/testing, but expect OS warnings:
> - macOS Gatekeeper warnings (especially when distributing outside your own machine)
> - Windows SmartScreen warnings

---

## Local packaging (macOS or Windows)

From repo root:

```zsh
pnpm install
pnpm desktop:build
```

Artifacts are typically written under:

- `src-tauri/target/release/bundle/`

---

## Auto-updates via GitHub Releases

### How the updater works

1. Your app checks an **endpoint** for a JSON manifest.
2. The manifest points to platform-specific update artifacts.
3. The updater downloads an update and applies it.

In this repo, the updater endpoint is configured in `src-tauri/tauri.conf.json`.

### Required: create a `latest.json` per release

Your updater endpoint is:

- `https://github.com/RBAT-Thorson/atlas/releases/latest/download/latest.json`

That means every release must upload a file named `latest.json` to the GitHub Release assets.

### What should be inside `latest.json`?

Use `tauri-apps/tauri-action` to generate it automatically. The updater JSON schema and required signatures vary by platform and Tauri version, so generating it during CI is the safest path.

---

## GitHub Actions release builds

The release workflow lives at:

- `.github/workflows/release-tauri.yml`

It builds bundles on:

- macOS runner
- Windows runner

and publishes them to a GitHub Release (draft by default).

### Required secrets

In your GitHub repo settings → **Secrets and variables** → **Actions**, add:

- `TAURI_SIGNING_PRIVATE_KEY`: private key generated by `pnpm tauri signer generate`
- `TAURI_SIGNING_PRIVATE_KEY_PASSWORD`: password (if you set one)

These are for **update signing** (not Apple/Windows code-signing).

### Recommended release method

This workflow triggers on tags matching `v*` (and also supports manual runs).

1. Update version in `src-tauri/tauri.conf.json`
2. Commit and push to main
3. Tag the commit and push the tag:

```zsh
git tag v0.1.1
git push origin v0.1.1
```

4. GitHub Actions builds macOS + Windows and creates a **draft** GitHub Release with:
  - installers
  - updater metadata (`latest.json`) and signatures
5. Open the draft release in GitHub and click **Publish** when ready.

---

## Versioning checklist

Update versions consistently:

- `src-tauri/tauri.conf.json` → `version`
- `src-tauri/Cargo.toml` → `[package].version` (optional but recommended to match)
- `package.json` → `version` (optional)

---

## Next improvements (recommended)

- Switch workflow to `tauri-apps/tauri-action` so it:
  - creates the GitHub Release
  - uploads installers
  - generates and uploads `latest.json`
- Add in-app UI to check for updates / prompt user

